<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æ´¾æ£®å°è‰çš„æˆé•¿è®°å½•</title>
<style>
body {margin:0; font-family: Arial, sans-serif; background-color:#4CAF50;}
.sidebar {
  position: fixed; top:0; left:0; width:250px; height:100vh; background-color:#4CAF50;
  padding:10px; box-sizing:border-box; overflow-y:auto; color:white;
}
.sidebar img {width:100px; height:100px; border-radius:50%; object-fit:cover; display:block; margin:0 auto 10px auto;}
.virtues-list {font-size:14px; line-height:1.4;}
.virtues-list p {margin:4px 0;}

/* é¡¶éƒ¨æ ‡é¢˜ + æœˆä»½é€‰æ‹© */
.header {
  position: fixed; top:0; left:250px; right:0; height:50px;
  display:flex; align-items:center; justify-content:space-between;
  background: rgba(0,0,0,0.1); color:white; font-size:18px;
  z-index:10;
  padding:0 20px;
}
.header select, .header button {margin-left:10px; padding:4px 6px; font-size:14px; cursor:pointer;}
.header-avatar {
  width: 35px;           /* è°ƒæ•´å¤´åƒå¤§å° */
  height: 35px;
  border-radius: 50%;
  object-fit: cover;
}
/* ä¸»å†…å®¹ */
.main {
  margin-left:250px; padding:60px 20px 20px 20px; display:flex; flex-direction:column; align-items:center;
  overflow-x:auto;
}

/* æ‰“å¡è¡¨ */
table {border-collapse: collapse; background:white; color:black; font-size:12px; table-layout: fixed;}
td, th {border:1px solid #ddd; text-align:center; padding:2px; width:40px; height:40px; white-space:nowrap;}
.row-title {background:#f0f0f0; font-weight:bold;}
.check-btn {cursor:pointer; border:none; background:none; font-size:12px;}
.diary-btn {cursor:pointer; font-size:12px;}
.diary-text {font-size:10px; word-break:break-word; max-height:30px; overflow:hidden;}

/* å¼¹çª— */
#diaryModal {display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:white; padding:10px; border:1px solid #aaa; z-index:1000; width:300px;}
#diaryTextarea {width:100%; box-sizing:border-box;}
#overlay {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:999;}
</style>
</head>
<body>

<div class="sidebar">
  <img src="avatar.jpg" alt="æˆ‘çš„å¤´åƒ">
  <div class="virtues-list">
    <p>1. èŠ‚åˆ¶ï¼šé¥­ä¸å¯åƒé¥±ï¼Œé…’ä¸å¯å–é«˜ã€‚</p>
    <p>2. ç¼„é»˜ï¼šäºäººäºå·±ä¸åˆ©çš„è¯ä¸è°ˆï¼Œé¿å…ç¢è¯­é—²è¨€ã€‚</p>
    <p>3. ç§©åºï¼šæ”¾ä¸œè¥¿å„å½’å…¶ä½ï¼ŒåŠäº‹æƒ…å„æŒ‰å…¶æ—¶ã€‚</p>
    <p>4. å†³å¿ƒï¼šå†³å¿ƒå»åšè¯¥åšçš„äº‹ï¼Œåšå°±åšåˆ°å¿ƒæƒ³äº‹æˆã€‚</p>
    <p>5. èŠ‚ä¿­ï¼šä¸èŠ±äºå·±äºäººæ²¡æœ‰å¥½å¤„çš„é—²é’±ï¼Œæœç»æµªè´¹ã€‚</p>
    <p>6. å‹¤å¥‹ï¼šçæƒœæ—¶å…‰ï¼Œæ‰‹é‡Œæ€»å¿™æœ‰ç›Šä¹‹äº‹ï¼Œå‰ªé™¤ä¸€åˆ‡æ— è°“ä¹‹ä¸¾ã€‚</p>
    <p>7. è¯šä¿¡ï¼šä¸å®³äººï¼Œä¸æ¬ºè¯ˆã€‚æ€æƒ³å¦è¡ï¼Œå…¬æ­£ï¼›è¯´è¯å®äº‹æ±‚æ˜¯ã€‚</p>
    <p>8. æ­£ä¹‰ï¼šä¸æŸäººåˆ©å·²ï¼Œä¼¤å¤©å®³ç†çš„è¡Œä¸ºæ°¸ä¸æ²¾è¾¹ï¼Œåˆ©å…¬åˆ©æ°‘çš„åº”å°½ä¹‰åŠ¡åˆ‡å‹¿æ”¾æ‰‹ã€‚</p>
    <p>9. ä¸­åº¸ï¼šé¿å…èµ°æç«¯ã€‚å¿è®©åŒ–å†¤ä»‡ã€‚</p>
    <p>10. æ¸…æ´ï¼šèº«ä½“ã€è¡£ç€ã€å±…æ‰€ï¼Œä¸è®¸ä¸å¹²ä¸å‡€ã€‚</p>
    <p>11. å¹³é™ï¼šä¸å¯ä¸ºå°äº‹ã€å¸¸äº‹æˆ–éš¾å…ä¹‹äº‹æ…ä¹±æ–¹å¯¸ã€‚</p>
    <p>12. è´æ´ï¼šå°‘è¡Œæˆ¿äº‹ï¼Œé™¤éä¸ºäº†èº«ä½“å¥åº·æˆ–ä¼ å®—æ¥ä»£ï¼›ä¸è¦å¤´è„‘æ˜æ²‰ï¼Œèº«ä½“è™šå¼±ã€‚ä¼¤å®³è‡ªå·±æˆ–ä»–äººçš„å¹³é™æˆ–å£°èª‰ã€‚</p>
    <p>13. è°¦å‘ï¼šæ•ˆæ³•è€¶ç¨£å’Œè‹æ ¼æ‹‰åº•ã€‚</p>
  </div>
</div>

<div class="header">
  
  <img src="avatar.jpg" alt="logo" class="header-avatar">
  <span>å‘ä¸‹æ‰æ ¹,å‘ä¸Šç”Ÿé•¿</span>
  <div>
    <select id="monthSelect"></select>
    <button id="saveRecords">ä¿å­˜è®°å½•</button>
  </div>
</div>

<div class="main">
  <table id="habitTable"></table>
</div>

<!-- å¼¹çª— -->
<div id="diaryModal">
  <textarea id="diaryTextarea" rows="5"></textarea>
  <div style="text-align:right; margin-top:5px;">
    <button id="diarySaveBtn">ä¿å­˜</button>
    <button id="diaryCancelBtn">å–æ¶ˆ</button>
  </div>
</div>
<div id="overlay"></div>

<script>
const virtues=["èŠ‚åˆ¶","ç¼„é»˜","ç§©åº","å†³å¿ƒ","èŠ‚ä¿­","å‹¤å¥‹","è¯šä¿¡","æ­£ä¹‰","ä¸­åº¸","æ¸…æ´","å¹³é™","è´æ´","è°¦å‘"];
const table=document.getElementById("habitTable");
const monthSelect=document.getElementById("monthSelect");
const now=new Date();
for(let i=-6;i<=6;i++){
  const d=new Date(now.getFullYear(), now.getMonth()+i,1);
  const val=d.toISOString().slice(0,7);
  const opt=document.createElement("option");
  opt.value=val; opt.textContent=val;
  if(val===now.toISOString().slice(0,7)) opt.selected=true;
  monthSelect.appendChild(opt);
}

// å¼¹çª—å˜é‡
let currentV, currentDay, currentMonth, currentDiaryDiv;
const diaryModal=document.getElementById("diaryModal");
const diaryTextarea=document.getElementById("diaryTextarea");
const overlay=document.getElementById("overlay");

function openDiary(v, day, month, diaryDiv){
  currentV=v; currentDay=day; currentMonth=month; currentDiaryDiv=diaryDiv;
  const data=JSON.parse(localStorage.getItem("habit-"+month)||"{}");
  const prevText=(data[v+"-diary"] && data[v+"-diary"][day])||"";
  diaryTextarea.value=prevText;
  diaryModal.style.display="block";
  overlay.style.display="block";
}

document.getElementById("diarySaveBtn").addEventListener("click",()=>{
  const text=diaryTextarea.value;
  saveDiary(currentMonth, currentV, currentDay, text);
  currentDiaryDiv.textContent=text.length>4?text.slice(0,4)+"â€¦":text;
  currentDiaryDiv.title=text;
  diaryModal.style.display="none";
  overlay.style.display="none";
});

document.getElementById("diaryCancelBtn").addEventListener("click",()=>{
  diaryModal.style.display="none";
  overlay.style.display="none";
});

// åˆ›å»ºè¡¨æ ¼
function createTable(month){
  table.innerHTML="";
  const firstDay=new Date(month+"-01");
  const year=firstDay.getFullYear();
  const mon=firstDay.getMonth();
  const daysInMonth=new Date(year,mon+1,0).getDate();

  const header=table.insertRow();
  header.insertCell().textContent="å¾·/æ—¥";
  for(let d=1;d<=daysInMonth;d++){
    const th=document.createElement("th");
    th.textContent=d;
    header.appendChild(th);
  }

  virtues.forEach(v=>{
    const row=table.insertRow();
    row.insertCell().textContent=v;
    row.cells[0].className="row-title";

    for(let d=1;d<=daysInMonth;d++){
      const cell=row.insertCell();

      const btn=document.createElement("button");
      btn.className="check-btn";
      btn.dataset.day=d-1;
      btn.textContent="âŒ";
      btn.addEventListener("click",()=>{ btn.textContent=btn.textContent==="âŒ"?"âœ…":"âŒ"; });

      const diaryBtn=document.createElement("button");
      diaryBtn.className="diary-btn";
      diaryBtn.textContent="ğŸ“";

      const diaryText=document.createElement("div");
      diaryText.className="diary-text";

      diaryBtn.addEventListener("click",()=>{ openDiary(v,d-1,month,diaryText); });

      cell.appendChild(btn);
      cell.appendChild(document.createElement("br"));
      cell.appendChild(diaryBtn);
      cell.appendChild(diaryText);
    }
  });

  loadMonth(month);
}

// ä¿å­˜æ—¥è®°
function saveDiary(month, virtue, day, text){
  const data=JSON.parse(localStorage.getItem("habit-"+month)||"{}");
  if(!data[virtue+"-diary"]) data[virtue+"-diary"]={};
  data[virtue+"-diary"][day]=text;
  localStorage.setItem("habit-"+month,JSON.stringify(data));
}

// ä¿å­˜æ‰“å¡è®°å½•
document.getElementById("saveRecords").addEventListener("click",()=>{
  const month=monthSelect.value;
  const data={};
  const rows=Array.from(table.rows).slice(1);
  rows.forEach(r=>{
    const virtue=r.cells[0].textContent;
    data[virtue]=[];
    for(let i=1;i<r.cells.length;i++){
      data[virtue].push(r.cells[i].querySelector(".check-btn").textContent);
    }
  });
  const oldData=JSON.parse(localStorage.getItem("habit-"+month)||"{}");
  const mergedData={...oldData,...data};
  localStorage.setItem("habit-"+month,JSON.stringify(mergedData));
  alert("å·²ä¿å­˜è®°å½•");
});

// åŠ è½½æœˆä»½
function loadMonth(month){
  const data=JSON.parse(localStorage.getItem("habit-"+month)||"{}");
  const rows=Array.from(table.rows).slice(1);
  rows.forEach(r=>{
    const virtue=r.cells[0].textContent;
    for(let i=1;i<r.cells.length;i++){
      const btn=r.cells[i].querySelector(".check-btn");
      if(data[virtue] && data[virtue][i-1]) btn.textContent=data[virtue][i-1];
      const diaryDiv=r.cells[i].querySelector(".diary-text");
      if(data[virtue+"-diary"] && data[virtue+"-diary"][i-1]){
        const text=data[virtue+"-diary"][i-1];
        diaryDiv.textContent=text.length>4?text.slice(0,4)+"â€¦":text;
        diaryDiv.title=text;
      }
    }
  });
}

// åˆ‡æ¢æœˆä»½
monthSelect.addEventListener("change",()=> createTable(monthSelect.value));

// åˆå§‹åŒ–
createTable(monthSelect.value);
</script>
</body>
</html>
